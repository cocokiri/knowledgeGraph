<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/14082/FileSaver.js'></script>
<script src="text.js"></script>
<script>
    let allText;

    //
    // fetch('http://127.0.0.1:8000/clip.txt')
    //     .then(
    //         function(response) {
    //             if (response.status !== 200) {
    //                 console.log('Looks like there was a problem. Status Code: ' +
    //                     response.status);
    //                 return;
    //             }
    //
    //             // Examine the text in the response
    //
    //                 console.log("data",data);
    //         }
    //     )
    //     .catch(function(err) {
    //         console.log('Fetch Error :-S', err);
    //     });
    //
    //
    // let txtFile = new XMLHttpRequest();
    // txtFile.open("GET", "clip.txt", true);
    // txtFile.onreadystatechange = function() {
    //     console.log(txtFile, 'text')
    //     if (txtFile.readyState === 4) { // Makes sure the document is ready to parse.
    //         if (txtFile.status === 200) { // Makes sure the file exists.
    //             allText = txtFile.responseText;
    //             console.log(txtFile, allText, "all")
    //
    //         }
    //     }
    // }


    const data = { haskell: {
        from: ["alexanderthegreat.txt, abc.txt, ad.txt"],
            vector: [200, 300, 400]
        }}



    const tt = text.split("\n")
        // .filter(e=> e[0] !== '-' && e[1] !== " ")
        .filter(e => e.length !== 0)

    function parse(array) {
        let counter = 0;

        for (let t of array) {
            if (t === '==========') {

            }
        }
    }

    let titleCount = 0;
    let title = "";
    let content = "";

    const arr = []

    for (let i = 0; i < tt.length-3; i++) {
        let title = "";
        if (tt[i+1][0] === '-' && tt[i+1][1] === " ") {
            if (title === tt[1+1]) {
                titleCount++;
            }
            else {
                title = tt[i] + "_" + titleCount;
            }
        }

        if (tt[i+3] === '==========') {
            content = tt[i+2];
        }
        if (title && content) {
            arr.push({title: title, content:content})
        }

    }
    console.log(arr, "arr");




    // arr.slice(500).map(e => saveFile(e.title, e.title + "\n/$$$/\n" + e.content))

    saveFile("kindleJSON", JSON.stringify(arr.slice(0,30)))

    function saveFile(fileName, content) {
        var blob = new Blob([content], {type: "text/plain;charset=utf-8"});
        saveAs(blob, fileName+".txt");
    }


</script>
</body>
</html>

